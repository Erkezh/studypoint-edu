<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>additiondragdrop</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        body.embed {
            padding: 0;
            background: transparent;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
      window.lucideReact = new Proxy({}, {
        get(_, name) {
          const toKebab = s => s.replace(/([A-Z])/g, '-$1').toLowerCase().replace(/^-/, '');
          return ({ size = 24, color, strokeWidth = 2, fill = 'none', className, ...props }) => {
            const ref = React.useRef();
            React.useEffect(() => {
              if (ref.current && lucide[toKebab(name)]) {
                ref.current.innerHTML = '';
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const iconData = lucide[toKebab(name)];
                svg.setAttribute('width', size);
                svg.setAttribute('height', size);
                svg.setAttribute('viewBox', '0 0 24 24');
                svg.setAttribute('fill', fill);
                svg.setAttribute('stroke', color || 'currentColor');
                svg.setAttribute('stroke-width', strokeWidth);
                svg.setAttribute('stroke-linecap', 'round');
                svg.setAttribute('stroke-linejoin', 'round');
                if (className) svg.setAttribute('class', className);
                iconData[2].forEach(el => {
                  const node = document.createElementNS('http://www.w3.org/2000/svg', el[0]);
                  Object.entries(el[1] || {}).forEach(([k,v]) => node.setAttribute(k, v));
                  svg.appendChild(node);
                });
                ref.current.appendChild(svg);
              }
            }, [size, color, strokeWidth, fill, className]);
            return React.createElement('span', { ref, style: { display: 'inline-flex' }, ...props });
          };
        }
      });
    </script>
    <script>
        (function() {
            const embedMode = /[?&]embed=1/i.test(window.location.search);
            if (embedMode) {
                document.body.classList.add('embed');
            }
            
            const { useState, useEffect } = React;
const { Check, X } = window.lucideReact;
const AdditionDragDrop = () => {
  const [problems, setProblems] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const [userAnswer, setUserAnswer] = useState("");
  const [showResult, setShowResult] = useState(false);
  const [score, setScore] = useState(0);
  const [draggedNumber, setDraggedNumber] = useState(null);
  const [firstSlot, setFirstSlot] = useState(null);
  const [secondSlot, setSecondSlot] = useState(null);
  const generateProblem = (id) => {
    const targetSum = Math.floor(Math.random() * 21) + 10;
    const firstNumber = Math.floor(Math.random() * (targetSum - 1)) + 1;
    const secondNumber = targetSum - firstNumber;
    const options = [firstNumber, secondNumber];
    const wrongOptions = /* @__PURE__ */ new Set();
    while (wrongOptions.size < 4) {
      const wrong = Math.floor(Math.random() * targetSum) + 1;
      if (wrong !== firstNumber && wrong !== secondNumber) {
        wrongOptions.add(wrong);
      }
    }
    options.push(...Array.from(wrongOptions));
    const shuffledOptions = options.sort(() => Math.random() - 0.5);
    const correctAnswer = `${firstNumber},${secondNumber}`;
    return {
      id,
      firstNumber,
      secondNumber,
      targetSum,
      options: shuffledOptions,
      correctAnswer: String(correctAnswer),
      equation: `[] + [] = ${targetSum}`
    };
  };
  const generateProblems = () => {
    const newProblems = [];
    for (let i = 0; i < 8; i++) {
      newProblems.push(generateProblem(i));
    }
    setProblems(newProblems);
    setCurrentIndex(0);
    setUserAnswer("");
    setShowResult(false);
    setScore(0);
    setFirstSlot(null);
    setSecondSlot(null);
  };
  useEffect(() => {
    generateProblems();
  }, []);
  const handleDragStart = (number) => {
    setDraggedNumber(number);
  };
  const handleDragOver = (e) => {
    e.preventDefault();
  };
  const handleDropFirst = (e) => {
    e.preventDefault();
    if (draggedNumber !== null) {
      setFirstSlot(draggedNumber);
      setDraggedNumber(null);
    }
  };
  const handleDropSecond = (e) => {
    e.preventDefault();
    if (draggedNumber !== null) {
      setSecondSlot(draggedNumber);
      setDraggedNumber(null);
    }
  };
  const handleClickNumber = (number) => {
    if (showResult) return;
    if (firstSlot === null) {
      setFirstSlot(number);
    } else if (secondSlot === null) {
      setSecondSlot(number);
    }
  };
  const handleClearSlot = (slot) => {
    if (showResult) return;
    if (slot === "first") {
      setFirstSlot(null);
    } else {
      setSecondSlot(null);
    }
  };
  const handleClearAll = () => {
    if (showResult) return;
    setFirstSlot(null);
    setSecondSlot(null);
  };
  const handleAnswerChange = (e) => {
    setUserAnswer(e.target.value);
  };
  const handleSubmit = () => {
    if (firstSlot === null || secondSlot === null) return;
    const correctAnswer = problems[currentIndex].correctAnswer;
    const userAnswerStr = `${firstSlot},${secondSlot}`;
    const userAnswerReversed = `${secondSlot},${firstSlot}`;
    const isCorrect = userAnswerStr === correctAnswer || userAnswerReversed === correctAnswer;
    if (isCorrect) {
      setScore(score + 1);
    }
    setUserAnswer(userAnswerStr);
    if (window.parent && window.parent !== window) {
      window.parent.postMessage(
        {
          type: "exercise-result",
          isCorrect,
          userAnswer: userAnswerStr,
          correctAnswer: String(correctAnswer),
          studentAnswer: userAnswerStr,
          question: `Solve: ${firstSlot} + ${secondSlot} = ${problems[currentIndex].targetSum}`
        },
        "*"
      );
    }
    setShowResult(true);
  };
  const handleNext = () => {
    if (currentIndex < problems.length - 1) {
      setCurrentIndex(currentIndex + 1);
      setUserAnswer("");
      setShowResult(false);
      setFirstSlot(null);
      setSecondSlot(null);
    }
  };
  const handleKeyPress = (e) => {
    if (e.key === "Enter" && !showResult && firstSlot !== null && secondSlot !== null) {
      handleSubmit();
    }
  };
  const currentProblem = problems[currentIndex];
  return /* @__PURE__ */ React.createElement("div", { className: "bg-gradient-to-br from-blue-50 to-cyan-100 p-6" }, /* @__PURE__ */ React.createElement("div", { className: "max-w-4xl mx-auto" }, /* @__PURE__ */ React.createElement("div", { className: "bg-white rounded-lg shadow-lg p-8" }, /* @__PURE__ */ React.createElement("div", { className: "mb-8" }, /* @__PURE__ */ React.createElement("h1", { className: "text-3xl font-bold text-blue-900" }, "Addition Challenge"), /* @__PURE__ */ React.createElement("p", { className: "text-gray-600 mt-2" }, "Drag or click numbers to complete the equation")), problems.length > 0 && currentIndex < problems.length && /* @__PURE__ */ React.createElement(React.Fragment, null, /* @__PURE__ */ React.createElement("div", { className: "mb-4 text-sm text-gray-600" }, "Question ", currentIndex + 1, " of ", problems.length), /* @__PURE__ */ React.createElement("div", { className: "border-2 border-gray-300 rounded-lg p-8 mb-8 bg-gradient-to-br from-white to-blue-50" }, /* @__PURE__ */ React.createElement("div", { className: "flex flex-col items-center gap-8" }, /* @__PURE__ */ React.createElement("div", { className: "flex items-center gap-4 text-4xl font-bold text-blue-900" }, /* @__PURE__ */ React.createElement(
    "div",
    {
      onDragOver: handleDragOver,
      onDrop: handleDropFirst,
      onClick: () => handleClearSlot("first"),
      className: `w-24 h-24 border-4 border-dashed rounded-lg flex items-center justify-center cursor-pointer transition ${firstSlot !== null ? "bg-blue-100 border-blue-400" : "bg-gray-50 border-gray-400 hover:border-blue-300"} ${showResult ? "cursor-not-allowed" : ""}`
    },
    firstSlot !== null ? /* @__PURE__ */ React.createElement("span", { className: "text-5xl font-bold text-blue-900" }, firstSlot) : /* @__PURE__ */ React.createElement("span", { className: "text-3xl text-gray-400" }, "?")
  ), /* @__PURE__ */ React.createElement("span", { className: "text-5xl" }, "+"), /* @__PURE__ */ React.createElement(
    "div",
    {
      onDragOver: handleDragOver,
      onDrop: handleDropSecond,
      onClick: () => handleClearSlot("second"),
      className: `w-24 h-24 border-4 border-dashed rounded-lg flex items-center justify-center cursor-pointer transition ${secondSlot !== null ? "bg-blue-100 border-blue-400" : "bg-gray-50 border-gray-400 hover:border-blue-300"} ${showResult ? "cursor-not-allowed" : ""}`
    },
    secondSlot !== null ? /* @__PURE__ */ React.createElement("span", { className: "text-5xl font-bold text-blue-900" }, secondSlot) : /* @__PURE__ */ React.createElement("span", { className: "text-3xl text-gray-400" }, "?")
  ), /* @__PURE__ */ React.createElement("span", { className: "text-5xl" }, "="), /* @__PURE__ */ React.createElement("span", { className: "text-5xl font-bold" }, currentProblem.targetSum)), /* @__PURE__ */ React.createElement("div", { className: "flex flex-wrap gap-3 justify-center mt-4" }, currentProblem.options.map((num, idx) => {
    const isUsed = num === firstSlot || num === secondSlot;
    return /* @__PURE__ */ React.createElement(
      "div",
      {
        key: idx,
        draggable: !showResult && !isUsed,
        onDragStart: () => handleDragStart(num),
        onClick: () => !isUsed && handleClickNumber(num),
        className: `w-20 h-20 rounded-lg flex items-center justify-center text-3xl font-bold transition ${isUsed ? "bg-gray-200 text-gray-400 cursor-not-allowed" : showResult ? "bg-gray-300 text-gray-500 cursor-not-allowed" : "bg-gradient-to-br from-blue-500 to-cyan-500 text-white cursor-move hover:from-blue-600 hover:to-cyan-600 shadow-md hover:shadow-lg"}`
      },
      num
    );
  })), !showResult && (firstSlot !== null || secondSlot !== null) && /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: handleClearAll,
      className: "mt-4 px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition font-semibold"
    },
    "Clear All"
  )), showResult && /* @__PURE__ */ React.createElement("div", { className: "mt-6 text-center" }, userAnswer === currentProblem.correctAnswer || userAnswer === `${currentProblem.secondNumber},${currentProblem.firstNumber}` ? /* @__PURE__ */ React.createElement("div", { className: "flex items-center justify-center gap-2 text-green-600 text-xl font-semibold" }, /* @__PURE__ */ React.createElement(Check, { size: 28 }), "Correct! ", firstSlot, " + ", secondSlot, " = ", currentProblem.targetSum) : /* @__PURE__ */ React.createElement("div", { className: "flex flex-col items-center gap-2 text-red-600 text-xl font-semibold" }, /* @__PURE__ */ React.createElement("div", { className: "flex items-center gap-2" }, /* @__PURE__ */ React.createElement(X, { size: 28 }), "Incorrect"), /* @__PURE__ */ React.createElement("div", { className: "text-gray-700" }, "Correct answer: ", currentProblem.firstNumber, " + ", currentProblem.secondNumber, " = ", currentProblem.targetSum)))), /* @__PURE__ */ React.createElement("div", { className: "flex justify-between items-center" }, /* @__PURE__ */ React.createElement("div", { className: "text-lg font-semibold text-blue-900" }, "Score: ", score, "/", problems.length), /* @__PURE__ */ React.createElement("div", { className: "flex gap-3" }, !showResult && /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: handleSubmit,
      disabled: firstSlot === null || secondSlot === null,
      className: `px-6 py-3 rounded-lg transition text-lg font-semibold ${firstSlot !== null && secondSlot !== null ? "bg-green-600 text-white hover:bg-green-700 cursor-pointer" : "bg-gray-300 text-gray-500 cursor-not-allowed"}`
    },
    "Submit"
  ), showResult && currentIndex < problems.length - 1 && /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: handleNext,
      className: "bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition text-lg font-semibold"
    },
    "Next Question"
  ), showResult && currentIndex === problems.length - 1 && /* @__PURE__ */ React.createElement(
    "button",
    {
      onClick: generateProblems,
      className: "bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition text-lg font-semibold"
    },
    "Try Again"
  )))))));
};

            
            // Рендерим компонент
            ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(AdditionDragDrop));
            
            // Функция для отправки высоты контента родителю
            function sendHeight() {
                if (embedMode && window.parent && window.parent !== window) {
                    const root = document.getElementById('root');
                    if (root) {
                        const height = Math.max(root.scrollHeight, root.offsetHeight, document.body.scrollHeight);
                        window.parent.postMessage({ type: 'resize', height: height + 20 }, '*');
                    }
                }
            }
            
            // Отправляем INIT сообщение и высоту
            if (embedMode && window.parent) {
                window.parent.postMessage({ type: 'INIT', status: 'ready' }, '*');
                // Отправляем высоту после рендеринга
                setTimeout(sendHeight, 100);
                setTimeout(sendHeight, 500);
                setTimeout(sendHeight, 1000);
                
                // Наблюдаем за изменениями DOM для обновления высоты
                const observer = new MutationObserver(() => {
                    setTimeout(sendHeight, 50);
                });
                observer.observe(document.getElementById('root'), { 
                    childList: true, 
                    subtree: true, 
                    attributes: true 
                });
                
                // Также отправляем высоту при изменении размера окна
                window.addEventListener('resize', sendHeight);
            }
        })();
    </script>
</body>
</html>