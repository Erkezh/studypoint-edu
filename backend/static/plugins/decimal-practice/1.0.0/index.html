<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>decimal-practice</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        body.embed {
            padding: 0;
            background: transparent;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
      window.lucideReact = new Proxy({}, {
        get(_, name) {
          const toKebab = s => s.replace(/([A-Z])/g, '-$1').toLowerCase().replace(/^-/, '');
          return ({ size = 24, color, strokeWidth = 2, fill = 'none', className, ...props }) => {
            const ref = React.useRef();
            React.useEffect(() => {
              if (ref.current && lucide[toKebab(name)]) {
                ref.current.innerHTML = '';
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const iconData = lucide[toKebab(name)];
                svg.setAttribute('width', size);
                svg.setAttribute('height', size);
                svg.setAttribute('viewBox', '0 0 24 24');
                svg.setAttribute('fill', fill);
                svg.setAttribute('stroke', color || 'currentColor');
                svg.setAttribute('stroke-width', strokeWidth);
                svg.setAttribute('stroke-linecap', 'round');
                svg.setAttribute('stroke-linejoin', 'round');
                if (className) svg.setAttribute('class', className);
                iconData[2].forEach(el => {
                  const node = document.createElementNS('http://www.w3.org/2000/svg', el[0]);
                  Object.entries(el[1] || {}).forEach(([k,v]) => node.setAttribute(k, v));
                  svg.appendChild(node);
                });
                ref.current.appendChild(svg);
              }
            }, [size, color, strokeWidth, fill, className]);
            return React.createElement('span', { ref, style: { display: 'inline-flex' }, ...props });
          };
        }
      });
    </script>
    <script type="text/babel">
        const embedMode = /[?&]embed=1/i.test(window.location.search);
        if (embedMode) {
            document.body.classList.add('embed');
        }
        
        const { useState, useEffect, CSSProperties, KeyboardEvent } = React;

interface Question {
  title: string;
  expression: string;
  correctAnswer: number;
  operation: string;
  a: number;
  b: number;
}

interface ResultData {
  id: string;
  correctAnswer: string;
  studentAnswer: string;
  isCorrect: boolean;
}

type FeedbackType = 'correct' | 'incorrect' | null;

const generateQuestion = (): Question => {
  const operations: string[] = ['add', 'subtract'];
  const operation: string = operations[Math.floor(Math.random() * operations.length)];
  
  const questionTypes: (() => { a: number; b: number; decimals: number })[] = [
    () => {
      const a = (Math.random() * 10 + 1).toFixed(1);
      const b = (Math.random() * 5 + 1).toFixed(1);
      return { a: parseFloat(a), b: parseFloat(b), decimals: 1 };
    },
    () => {
      const a = (Math.random() * 100 + 10).toFixed(2);
      const b = (Math.random() * 50 + 1).toFixed(2);
      return { a: parseFloat(a), b: parseFloat(b), decimals: 2 };
    },
    () => {
      const a = (Math.random() * 1 + 0.1).toFixed(3);
      const b = (Math.random() * 0.5 + 0.1).toFixed(3);
      return { a: parseFloat(a), b: parseFloat(b), decimals: 3 };
    },
    () => {
      const a = Math.floor(Math.random() * 100 + 10);
      const b = (Math.random() * 50 + 1).toFixed(2);
      return { a: a, b: parseFloat(b), decimals: 2 };
    },
    () => {
      const a = Math.floor(Math.random() * 10 + 2);
      const b = (Math.random() * 0.9 + 0.1).toFixed(2);
      return { a: a, b: parseFloat(b), decimals: 2 };
    },
    () => {
      const a = (Math.random() * 50 + 10).toFixed(2);
      const b = (Math.random() * 30 + 5).toFixed(2);
      return { a: parseFloat(a), b: parseFloat(b), decimals: 2 };
    },
  ];

  const type = questionTypes[Math.floor(Math.random() * questionTypes.length)]();
  let { a, b, decimals } = type;

  if (operation === 'subtract' && a < b) {
    [a, b] = [b, a];
  }

  const correctAnswer: number = operation === 'add' 
    ? parseFloat((a + b).toFixed(decimals))
    : parseFloat((a - b).toFixed(decimals));

  const title: string = operation === 'add' ? 'Қосу' : 'Азайту';
  const expression: string = operation === 'add' 
    ? `${a} + ${b} = `
    : `${a} − ${b} = `;

  return {
    title,
    expression,
    correctAnswer,
    operation,
    a,
    b,
  };
};

const getExplanation = (question: Question): string => {
  const { operation, a, b, correctAnswer } = question;
  
  if (operation === 'add') {
    return `${a} + ${b} = ${correctAnswer}. Ондық бөлшектерді қосқанда, үтірлерді тігінен туралап, әр разрядты бөлек қосамыз.`;
  } else {
    return `${a} − ${b} = ${correctAnswer}. Ондық бөлшектерді азайтқанда, үтірлерді тігінен туралап, әр разрядты бөлек азайтамыз.`;
  }
};

 DecimalPractice(): React.ReactElement | null {
  const [question, setQuestion] = useState<Question | null>(null);
  const [userAnswer, setUserAnswer] = useState<string>('');
  const [feedback, setFeedback] = useState<FeedbackType>(null);
  const [showExplanation, setShowExplanation] = useState<boolean>(false);
  const [questionNumber, setQuestionNumber] = useState<number>(1);

  useEffect(() => {
    setQuestion(generateQuestion());
  }, []);

  const sendResult = (isCorrect: boolean, studentAnswer: string, correctAnswer: number): void => {
    const data: ResultData = {
      id: `decimal-operations-q${questionNumber}`,
      correctAnswer: String(correctAnswer),
      studentAnswer: String(studentAnswer),
      isCorrect: isCorrect
    };
    
    console.log(data);
    
    if (window.parent !== window) {
      window.parent.postMessage(data, '*');
    }
  };

  const checkAnswer = (): void => {
    if (!question || userAnswer.trim() === '') return;
    
    const parsed: number = parseFloat(userAnswer.replace(',', '.'));
    const isCorrect: boolean = Math.abs(parsed - question.correctAnswer) < 0.0001;
    
    sendResult(isCorrect, userAnswer.trim(), question.correctAnswer);
    
    setFeedback(isCorrect ? 'correct' : 'incorrect');
    
    if (isCorrect) {
      setTimeout(() => {
        nextQuestion();
      }, 1200);
    } else {
      setShowExplanation(true);
    }
  };

  const nextQuestion = (): void => {
    setQuestion(generateQuestion());
    setUserAnswer('');
    setFeedback(null);
    setShowExplanation(false);
    setQuestionNumber(prev => prev + 1);
  };

  const handleUnderstood = (): void => {
    nextQuestion();
  };

  const handleKeyPress = (e: KeyboardEvent<HTMLInputElement>): void => {
    if (e.key === 'Enter' && !feedback) {
      checkAnswer();
    }
  };

  if (!question) return null;

  return (
    <div style={styles.container}>
      <h1 style={styles.mainTitle}>Ондық бөлшектерді қосу және азайту</h1>
      
      <div style={styles.card}>
        <h2 style={styles.taskTitle}>{question.title}</h2>
        
        <div style={styles.questionContainer}>
          <span style={styles.expression}>{question.expression}</span>
          <input
            type="text"
            value={userAnswer}
            onChange={(e) => setUserAnswer(e.target.value)}
            onKeyPress={handleKeyPress}
            style={styles.input}
            disabled={feedback !== null}
            autoFocus
          />
        </div>

        {feedback === null && (
          <button onClick={checkAnswer} style={styles.checkButton}>
            Тексеру
          </button>
        )}

        {feedback === 'correct' && (
          <div style={styles.feedbackCorrect}>
            <span style={styles.checkMark}>✓</span> Дұрыс
          </div>
        )}

        {feedback === 'incorrect' && (
          <div style={styles.feedbackContainer}>
            <div style={styles.feedbackIncorrect}>
              Қате
            </div>
            {showExplanation && (
              <>
                <div style={styles.explanation}>
                  {getExplanation(question)}
                </div>
                <button onClick={handleUnderstood} style={styles.understoodButton}>
                  Түсіндім
                </button>
              </>
            )}
          </div>
        )}
      </div>
    </div>
  );
}

const styles: { [key: string]: CSSProperties } = {
  container: {
    minHeight: '100vh',
    backgroundColor: '#f5f5f5',
    padding: '20px',
    boxSizing: 'border-box',
    fontFamily: 'Verdana, sans-serif',
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
  },
  mainTitle: {
    fontSize: 'clamp(1.2rem, 4vw, 1.8rem)',
    color: '#323048',
    textAlign: 'center',
    marginBottom: '30px',
    fontWeight: 'normal',
  },
  card: {
    backgroundColor: '#ffffff',
    borderRadius: '8px',
    padding: 'clamp(20px, 5vw, 40px)',
    width: '100%',
    maxWidth: '500px',
    boxShadow: '0 2px 8px rgba(0,0,0,0.1)',
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
  },
  taskTitle: {
    fontSize: 'clamp(1rem, 3vw, 1.3rem)',
    color: '#323048',
    marginBottom: '25px',
    fontWeight: 'normal',
  },
  questionContainer: {
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    flexWrap: 'wrap',
    gap: '10px',
    marginBottom: '25px',
    width: '100%',
  },
  expression: {
    fontSize: 'clamp(1.1rem, 3.5vw, 1.4rem)',
    color: '#333',
  },
  input: {
    fontSize: 'clamp(1rem, 3vw, 1.2rem)',
    padding: '10px 15px',
    border: '1px solid #ddd',
    borderRadius: '4px',
    width: 'clamp(80px, 25vw, 120px)',
    textAlign: 'center',
    backgroundColor: '#ffffff',
    outline: 'none',
    fontFamily: 'Verdana, sans-serif',
  },
  checkButton: {
    backgroundColor: '#323048',
    color: '#ffffff',
    border: 'none',
    borderRadius: '4px',
    padding: '12px 35px',
    fontSize: 'clamp(0.9rem, 2.5vw, 1rem)',
    cursor: 'pointer',
    fontFamily: 'Verdana, sans-serif',
  },
  feedbackCorrect: {
    color: '#2e7d32',
    fontSize: 'clamp(1.1rem, 3vw, 1.3rem)',
    display: 'flex',
    alignItems: 'center',
    gap: '8px',
  },
  checkMark: {
    fontSize: 'clamp(1.3rem, 3.5vw, 1.5rem)',
    fontWeight: 'bold',
  },
  feedbackContainer: {
    display: 'flex',
    flexDirection: 'column',
    alignItems: 'center',
    width: '100%',
  },
  feedbackIncorrect: {
    color: '#c62828',
    fontSize: 'clamp(1.1rem, 3vw, 1.3rem)',
    marginBottom: '15px',
  },
  explanation: {
    backgroundColor: '#fff8e1',
    padding: '15px',
    borderRadius: '4px',
    fontSize: 'clamp(0.85rem, 2.5vw, 0.95rem)',
    color: '#5d4037',
    textAlign: 'center',
    marginBottom: '20px',
    lineHeight: '1.5',
    width: '100%',
    boxSizing: 'border-box',
  },
  understoodButton: {
    backgroundColor: '#323048',
    color: '#ffffff',
    border: 'none',
    borderRadius: '4px',
    padding: '12px 35px',
    fontSize: 'clamp(0.9rem, 2.5vw, 1rem)',
    cursor: 'pointer',
    fontFamily: 'Verdana, sans-serif',
  },
};

        
        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(function));
        
        // Отправляем INIT сообщение
        if (embedMode && window.parent) {
            window.parent.postMessage({ type: 'INIT', status: 'ready' }, '*');
        }
    </script>
</body>
</html>