<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kazakhmultiplicationapp</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        body.embed {
            padding: 0;
            background: transparent;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
      window.lucideReact = new Proxy({}, {
        get(_, name) {
          const toKebab = s => s.replace(/([A-Z])/g, '-$1').toLowerCase().replace(/^-/, '');
          return ({ size = 24, color, strokeWidth = 2, fill = 'none', className, ...props }) => {
            const ref = React.useRef();
            React.useEffect(() => {
              if (ref.current && lucide[toKebab(name)]) {
                ref.current.innerHTML = '';
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                const iconData = lucide[toKebab(name)];
                svg.setAttribute('width', size);
                svg.setAttribute('height', size);
                svg.setAttribute('viewBox', '0 0 24 24');
                svg.setAttribute('fill', fill);
                svg.setAttribute('stroke', color || 'currentColor');
                svg.setAttribute('stroke-width', strokeWidth);
                svg.setAttribute('stroke-linecap', 'round');
                svg.setAttribute('stroke-linejoin', 'round');
                if (className) svg.setAttribute('class', className);
                iconData[2].forEach(el => {
                  const node = document.createElementNS('http://www.w3.org/2000/svg', el[0]);
                  Object.entries(el[1] || {}).forEach(([k,v]) => node.setAttribute(k, v));
                  svg.appendChild(node);
                });
                ref.current.appendChild(svg);
              }
            }, [size, color, strokeWidth, fill, className]);
            return React.createElement('span', { ref, style: { display: 'inline-flex' }, ...props });
          };
        }
      });
    </script>
    <script type="text/babel">
        const embedMode = /[?&]embed=1/i.test(window.location.search);
        if (embedMode) {
            document.body.classList.add('embed');
        }
        
        const { useState, useEffect } = React;
const { RefreshCw, Check, X, Trophy, BookOpen } = window.lucideReact;

const KazakhMultiplicationApp = () => {
  const [currentQuestion, setCurrentQuestion] = useState(null);
  const [userAnswers, setUserAnswers] = useState({
    topLeft: '',
    topRight: '',
    bottomLeft: '',
    bottomRight: '',
    total: ''
  });
  const [showAnswer, setShowAnswer] = useState(false);
  const [score, setScore] = useState(0);
  const [totalQuestions, setTotalQuestions] = useState(0);
  const [feedback, setFeedback] = useState('');
  const [questionHistory, setQuestionHistory] = useState([]);

  // Generate a random 2-digit number
  const generateTwoDigitNumber = () => {
    return Math.floor(Math.random() * 90) + 10; // 10-99
  };

  // Generate a new question
  const generateQuestion = () => {
    const num1 = generateTwoDigitNumber();
    const num2 = generateTwoDigitNumber();
    
    const tens1 = Math.floor(num1 / 10) * 10;
    const ones1 = num1 % 10;
    const tens2 = Math.floor(num2 / 10) * 10;
    const ones2 = num2 % 10;
    
    const question = {
      num1,
      num2,
      tens1,
      ones1,
      tens2,
      ones2,
      partialProducts: {
        topLeft: tens1 * tens2,
        topRight: tens1 * ones2,
        bottomLeft: ones1 * tens2,
        bottomRight: ones1 * ones2
      },
      total: num1 * num2
    };
    
    setCurrentQuestion(question);
    setUserAnswers({
      topLeft: '',
      topRight: '',
      bottomLeft: '',
      bottomRight: '',
      total: ''
    });
    setShowAnswer(false);
    setFeedback('');
  };

  // Initialize with first question
  useEffect(() => {
    generateQuestion();
  }, []);

  // Handle input changes
  const handleInputChange = (field, value) => {
    if (value === '' || /^\d+$/.test(value)) {
      setUserAnswers(prev => ({
        ...prev,
        [field]: value
      }));
    }
  };

  // Check answer
  const checkAnswer = () => {
    if (!currentQuestion) return;
    
    const { partialProducts, total } = currentQuestion;
    const correct = {
      topLeft: parseInt(userAnswers.topLeft) === partialProducts.topLeft,
      topRight: parseInt(userAnswers.topRight) === partialProducts.topRight,
      bottomLeft: parseInt(userAnswers.bottomLeft) === partialProducts.bottomLeft,
      bottomRight: parseInt(userAnswers.bottomRight) === partialProducts.bottomRight,
      total: parseInt(userAnswers.total) === total
    };
    
    const allCorrect = Object.values(correct).every(Boolean);
    
    if (allCorrect) {
      setScore(score + 1);
      setFeedback('Дұрыс! Өте жақсы!');
      // Auto move to next question after 2 seconds if correct
      setTimeout(() => {
        generateQuestion();
      }, 2000);
    } else {
      setFeedback('Қате бар. Қайта көріңіз.');
    }
    
    setTotalQuestions(totalQuestions + 1);
    setShowAnswer(true);
    
    // Add to history
    setQuestionHistory(prev => [...prev, {
      question: `${currentQuestion.num1} × ${currentQuestion.num2}`,
      correct: allCorrect,
      answer: total
    }].slice(-10)); // Keep last 10 questions
  };

  // Next question
  const nextQuestion = () => {
    generateQuestion();
  };

  if (!currentQuestion) return <div>Жүктелуде...</div>;

  const { num1, num2, tens1, ones1, tens2, ones2, partialProducts, total } = currentQuestion;

  return (
    <div className="max-w-4xl mx-auto p-6 bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
      {/* Header */}
      <div className="text-center mb-8">
        <h1 className="text-3xl font-bold text-blue-800 mb-2 flex items-center justify-center gap-3">
          <BookOpen className="text-blue-600" />
          2-таңбалы сандарды көбейту үлгісі
        </h1>
      </div>



      {/* Main Question */}
      <div className="bg-white rounded-xl shadow-lg p-8 mb-6">
        <div className="text-center mb-6">
          <h2 className="text-2xl font-bold text-gray-800 mb-2">
            Үлгіні пайдаланып табыңыз: {num1} × {num2}
          </h2>
          <p className="text-gray-600">Алдымен әр тіктөртбұрыштың ауданын табыңыз</p>
        </div>

        {/* Area Model Grid */}
        <div className="flex justify-center mb-6">
          <div className="grid grid-cols-3 gap-2 max-w-md">
            {/* Header row */}
            <div></div>
            <div className="bg-blue-100 p-3 text-center font-bold rounded-lg border-2 border-blue-300">
              {tens2}
            </div>
            <div className="bg-blue-100 p-3 text-center font-bold rounded-lg border-2 border-blue-300">
              {ones2}
            </div>
            
            {/* First data row */}
            <div className="bg-green-100 p-3 text-center font-bold rounded-lg border-2 border-green-300">
              {tens1}
            </div>
            <div className="bg-yellow-100 p-4 rounded-lg border-2 border-yellow-300">
              <input
                type="text"
                value={userAnswers.topLeft}
                onChange={(e) => handleInputChange('topLeft', e.target.value)}
                className="w-full text-center border-2 border-gray-300 rounded-md p-2 text-lg font-semibold"
                disabled={showAnswer}
              />
              {showAnswer && (
                <div className="text-sm mt-1 text-gray-600">
                  {tens1} × {tens2} = {partialProducts.topLeft}
                </div>
              )}
            </div>
            <div className="bg-yellow-100 p-4 rounded-lg border-2 border-yellow-300">
              <input
                type="text"
                value={userAnswers.topRight}
                onChange={(e) => handleInputChange('topRight', e.target.value)}
                className="w-full text-center border-2 border-gray-300 rounded-md p-2 text-lg font-semibold"
                disabled={showAnswer}
              />
              {showAnswer && (
                <div className="text-sm mt-1 text-gray-600">
                  {tens1} × {ones2} = {partialProducts.topRight}
                </div>
              )}
            </div>
            
            {/* Second data row */}
            <div className="bg-green-100 p-3 text-center font-bold rounded-lg border-2 border-green-300">
              {ones1}
            </div>
            <div className="bg-yellow-100 p-4 rounded-lg border-2 border-yellow-300">
              <input
                type="text"
                value={userAnswers.bottomLeft}
                onChange={(e) => handleInputChange('bottomLeft', e.target.value)}
                className="w-full text-center border-2 border-gray-300 rounded-md p-2 text-lg font-semibold"
                disabled={showAnswer}
              />
              {showAnswer && (
                <div className="text-sm mt-1 text-gray-600">
                  {ones1} × {tens2} = {partialProducts.bottomLeft}
                </div>
              )}
            </div>
            <div className="bg-yellow-100 p-4 rounded-lg border-2 border-yellow-300">
              <input
                type="text"
                value={userAnswers.bottomRight}
                onChange={(e) => handleInputChange('bottomRight', e.target.value)}
                className="w-full text-center border-2 border-gray-300 rounded-md p-2 text-lg font-semibold"
                disabled={showAnswer}
              />
              {showAnswer && (
                <div className="text-sm mt-1 text-gray-600">
                  {ones1} × {ones2} = {partialProducts.bottomRight}
                </div>
              )}
            </div>
          </div>
        </div>

        {/* Total calculation */}
        <div className="text-center mb-6">
          <p className="text-lg font-semibold mb-3 text-gray-700">
            Содан кейін жалпы ауданды табыңыз:
          </p>
          <div className="bg-purple-50 rounded-lg p-4 inline-block border-2 border-purple-200">
            <div className="text-xl font-bold mb-2">
              {num1} × {num2} = 
              <input
                type="text"
                value={userAnswers.total}
                onChange={(e) => handleInputChange('total', e.target.value)}
                className="ml-2 w-24 text-center border-2 border-gray-300 rounded-md p-2 text-xl font-bold"
                disabled={showAnswer}
              />
            </div>
            {showAnswer && (
              <div className="text-sm text-gray-600">
                {partialProducts.topLeft} + {partialProducts.topRight} + {partialProducts.bottomLeft} + {partialProducts.bottomRight} = {total}
              </div>
            )}
          </div>
        </div>

        {/* Buttons */}
        <div className="flex justify-center gap-4 mb-4">
          {!showAnswer ? (
            <button
              onClick={checkAnswer}
              className="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center gap-2"
            >
              <Check size={20} />
              Тексеру
            </button>
          ) : (
            feedback.includes('Қате') && (
              <button
                onClick={nextQuestion}
                className="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center gap-2"
              >
                <RefreshCw size={20} />
                Келесі сұрақ
              </button>
            )
          )}
        </div>

        {/* Feedback */}
        {feedback && (
          <div className={`text-center p-3 rounded-lg font-semibold ${
            feedback.includes('Дұрыс') 
              ? 'bg-green-100 text-green-800 border-2 border-green-300' 
              : 'bg-red-100 text-red-800 border-2 border-red-300'
          }`}>
            {feedback.includes('Дұрыс') ? (
              <Check className="inline mr-2" size={20} />
            ) : (
              <X className="inline mr-2" size={20} />
            )}
            {feedback}
          </div>
        )}
      </div>

      {/* Question History */}
      {questionHistory.length > 0 && (
        <div className="bg-white rounded-xl shadow-lg p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4">
            Соңғы сұрақтар
          </h3>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {questionHistory.slice(-6).map((item, index) => (
              <div
                key={index}
                className={`p-3 rounded-lg border-2 ${
                  item.correct 
                    ? 'bg-green-50 border-green-300 text-green-800' 
                    : 'bg-red-50 border-red-300 text-red-800'
                }`}
              >
                <div className="font-semibold">{item.question}</div>
                <div className="text-sm">Жауабы: {item.answer}</div>
                <div className="text-xs">
                  {item.correct ? '✓ Дұрыс' : '✗ Қате'}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Instructions */}
      <div className="mt-6 bg-blue-50 rounded-xl p-6 border-2 border-blue-200">
        <h3 className="text-lg font-bold text-blue-800 mb-3">
          Нұсқаулық:
        </h3>
        <ul className="text-blue-700 space-y-2">
          <li>• Екі санды оларды ондықтар мен бірлікке бөлу арқылы көбейтіңіз</li>
          <li>• Әр тіктөртбұрыштың ауданын табыңыз (ұзындығы × ені)</li>
          <li>• Барлық ауданды қосып, жауапты табыңыз</li>
          <li>• Мысал: 23 × 45 = (20×40) + (20×5) + (3×40) + (3×5)</li>
        </ul>
      </div>
    </div>
  );
};


        
        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(KazakhMultiplicationApp));
        
        // Отправляем INIT сообщение
        if (embedMode && window.parent) {
            window.parent.postMessage({ type: 'INIT', status: 'ready' }, '*');
        }
    </script>
</body>
</html>